---
import { Image } from "astro:assets";
import BaseLayout from "../../layouts/BaseLayout.astro";
import { resolveContentImage } from '../../utils/resolveContentImage';

export const prerender = true;

export function getStaticPaths() {
  const entries = import.meta.glob('../../content/realizacje/*.md', { eager: true });
  return Object.entries(entries).map(([file, entry]) => {
    const slug = file.split('/').pop().replace('.md', '');
    return {
      params: { slug },
      props: { realizacja: { slug, ...entry.frontmatter }, Content: entry.Content },
    };
  });
}

const { realizacja, Content } = Astro.props;
const headerImage = resolveContentImage(realizacja?.imageMain ?? realizacja?.thumbnail ?? realizacja?.tileImage);
const date = realizacja?.date ? new Date(realizacja.date) : null;
const year = date && !Number.isNaN(date.getTime()) ? date.getFullYear() : null;

if (!realizacja) {
  return Astro.redirect('/realizacje');
}
---

<BaseLayout
  title={realizacja.title ?? realizacja.slug}
  description={realizacja.description}
  showHero={false}
  robots={"noindex"}
>

<section class="pb-16 pt-26 md:pb-20 md:pt-38 grid gap-8 md:gap-12 md:grid-cols-[minmax(0,1fr)_minmax(0,1fr)] items-start">
  {/* Lewa kolumna: Obrazek z Twoim charakterystycznym obramowaniem i lekkim desaturatem */}
  <div class="relative group">
    {headerImage ? (
      <div class="overflow-hidden rounded-2xl border border-white/10">
        <Image
          class="aspect-square w-full object-cover opacity-90 transition-all duration-700 group-hover:opacity-100 group-hover:scale-[1.02]"
          src={headerImage}
          alt={realizacja.title ?? realizacja.slug}
          widths={[320, 480, 768, 960, 1100, 1400]}
          sizes="(max-width: 1024px) 100vw, 800px"
          loading="lazy"
          placeholder="blur"
        />
      </div>
    ) : (
      <div class="grid aspect-square place-items-center rounded-2xl border border-dashed border-white/10 bg-neutral-100 text-[10px] uppercase tracking-widest text-neutral-500">
        Brak wizualizacji projektu
      </div>
    )}
    {/* Dekoracyjny element - pomarańczowy akcent w rogu obrazka, nawiązujący do Twojego Hero */}
    <div class="absolute -bottom-2 -left-2 h-12 w-12 bg-orange-600/20 blur-2xl opacity-0 group-hover:opacity-100 transition-opacity"></div>
  </div>

  {/* Prawa kolumna: Detale projektu */}
  <div class="sticky top-34 space-y-10">

      {realizacja.link && (
        <div class="col-span-2 pt-4">
          <h2 class="text-2xl sm:text-3xl md:text-4xl font-semibold tracking-tight text-black mb-6">{realizacja.title} </h2>
          <a 
            href={realizacja.link} 
            rel="noopener" 
            target="_blank" 
            class="group inline-flex items-center gap-3 text-xs uppercase tracking-[0.1em] font-semibold hover:text-[var(--accent)] transition-colors"
          >
            <span>Zobacz online</span>
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 transition-transform group-hover:translate-x-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
            </svg>
          </a>
        </div>
      )}

    {/* Dynamiczna treść MDX/Content */}
    {Content ? (
      <div class="prose prose-invert prose-sm max-w-none text-neutral-500 
        [&>p]:leading-relaxed [&>p]:mb-4
        [&>h2]:text-white [&>h2]:text-xl [&>h2]:font-bold [&>h2]:mt-8 [&>h2]:mb-4
        [&>ul]:list-disc [&>ul]:pl-5 [&>ul]:space-y-2
        [&>a]:text-orange-500 [&>a]:no-underline hover:[&>a]:underline">
        <Content />
      </div>
    ) : null}

      <div class="grid gap-12 md:grid-cols-[minmax(0,2fr)_minmax(0,5fr)]">

      {year && (
        <div>
          <p class="text-[10px] uppercase tracking-[0.2em] text-neutral-500 font-bold mb-3">Rok</p>
          <p class="text-sm text-neutral-00 font-medium">{year}</p>
        </div>
      )}
      {realizacja.category?.length && (
        <div class="">
          <p class="text-[10px] uppercase tracking-[0.2em] text-neutral-500 font-bold mb-3">Zakres prac</p>
          <div class="flex flex-wrap gap-2">
            {realizacja.category.map((cat) => (
              <span class="text-sm text-neutral-00 font-medium">
                {cat}
              </span>
            ))}
          </div>
        </div>
      )}
      </div>

      {/* Powrót */}
    <div class="pt-6">
      <a 
        class="inline-flex items-center gap-2 text-xs uppercase tracking-widest text-neutral-600 hover:text-[var(--accent)] transition-colors" 
        href="/realizacje/"
      >
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
        </svg>
        Wróć do listy
      </a>
    </div>

    </div>

  </div>
</section>

</BaseLayout>
