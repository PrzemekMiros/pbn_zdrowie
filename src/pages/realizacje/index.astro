---
import { Image } from "astro:assets";
import BaseLayout from "../../layouts/BaseLayout.astro";

const imageEntries = import.meta.glob("/src/content/realizacje/img/**/*", { eager: true });
const resolveContentImage = (path) => {
  if (!path) return null;
  const normalized = path.startsWith("/src/") ? path : `/src${path}`;
  const entry = imageEntries[normalized];
  return entry?.default ?? null;
};

const entries = import.meta.glob("../../content/realizacje/*.md", { eager: true });
const items = Object.entries(entries).map(([file, entry]) => {
  const slug = file.split("/").pop().replace(".md", "");
  return { slug, ...entry.frontmatter };
});
---

<BaseLayout
  title="Wybrane realizacje"
  description="Galeria wybranych projektow i wdrozen. Zobacz szczegoly realizacji i zakres prac."
>

<section class="mb-24 mt-16">
  <div class="grid gap-8 lg:grid-cols-[minmax(0,1fr)_300px]">
    {/* Główna lista realizacji */}
    <div class="grid gap-6 md:grid-cols-[minmax(0,1fr)_minmax(0,1fr)]">
      {items.map((realizacja) => {
        const image = resolveContentImage(
          realizacja.tileImage ?? realizacja.thumbnail ?? realizacja.imageMain
        );
        const tag = Array.isArray(realizacja.category) ? realizacja.category[0] : realizacja.category;
        const date = realizacja.date ? new Date(realizacja.date) : null;
        const formattedDate = date ? date.toLocaleDateString('pl-PL', { month: 'long', year: 'numeric' }) : null;
        const bgColor = realizacja.background ?? realizacja.tileBg;

        return (
        <article 
          class="group relative overflow-hidden rounded-2xl border border-black/6 transition-all duration-500 hover:border-orange-600/30"
          style={bgColor ? `background-color: ${bgColor};` : undefined}
        >
          {/* Kontener obrazka z Twoim efektem grayscale/zoom */}
          <div class="relative aspect-[12/10] overflow-hidden">
            {image ? (
              <Image
                class="w-full h-full object-cover transition-all duration-700 ease-in-out group-hover:scale-105"
                src={image}
                alt={realizacja.title ?? realizacja.slug}
                widths={[400, 800]}
                sizes="(max-width: 768px) 100vw, 600px"
                loading="lazy"
              />
            ) : (
              <div class="flex h-full items-center justify-center text-[10px] uppercase tracking-widest text-neutral-600">
                Brak podglądu projektu
              </div>
            )}

          </div>

          {/* Treść dopasowana do stylu strony głównej */}
          <div class="p-8 relative z-10">
            <div class="flex justify-between items-center mb-4">
              {tag && (
                <span class="text-orange-600 text-[11px] font-semibold uppercase tracking-[0.1em]">
                  {tag}
                </span>
              )}
              {formattedDate && (
                <span class="text-neutral-500 text-[11px] uppercase tracking-wider">
                  {formattedDate}
                </span>
              )}
            </div>

            <div class="flex justify-between items-end gap-4">
              <div class="flex-1">
                <h3 class="text-xl lg:text-xl xl:text-2xl font-semibold tracking-tight leading-tight">
                  {realizacja.title ?? realizacja.slug}
                </h3>
              </div>

              {/* Ikona akcji - minimalistyczna, pomarańczowa w hoverze */}
              <div
                class="flex h-12 w-12 shrink-0 items-center justify-center rounded-full border border-white/10 bg-neutral-200 text-white transition-all duration-300 group-hover:bg-orange-600 group-hover:border-orange-600 group-hover:rotate-45"
              >
              <svg class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path></svg>
              </div>
            </div>
          </div>
          
          {/* Cała karta jako link */}
          <a href={`/realizacje/${realizacja.slug}/`} class="absolute inset-0 z-20" aria-label={`Zobacz projekt: ${realizacja.title}`}></a>
        </article>
        );
      })}
    </div>

    {/* Sidebar bez pętli kategorii */}
    <aside class="sticky top-34 self-start space-y-8">
      <div class="rounded-2xl bg-neutral-50 p-8 border border-black/5">
        <h3 class="text-xs font-bold uppercase tracking-[0.2em] mb-4 border-l-2 border-orange-600 pl-4">
          O projektach
        </h3>
        <p class="text-sm text-neutral-600 leading-relaxed">
          W tej sekcji znajdziesz moje wybrane realizacje. Każdy projekt to indywidualne podejście i dbałość o detale.
        </p>
      </div>
    </aside>
  </div>
</section>
</BaseLayout>