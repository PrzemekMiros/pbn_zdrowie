---
const entries = import.meta.glob('../../content/opinie/*.md', { eager: true });

const testimonials = Object.values(entries)
  .map((mod) => {
    const { title, client, review, name, role, quote, order } = mod.frontmatter ?? {};
    return {
      name: name ?? title,
      role: role ?? client,
      quote: quote ?? review,
      order,
    };
  })
  .filter((item) => item && item.name && item.quote)
  .sort((a, b) => {
    const orderA = typeof a.order === 'number' ? a.order : Number.MAX_SAFE_INTEGER;
    const orderB = typeof b.order === 'number' ? b.order : Number.MAX_SAFE_INTEGER;
    if (orderA !== orderB) return orderA - orderB;
    return String(a.name).localeCompare(String(b.name));
  });
---

<section class="mt-24">
  <div class="space-y-3">
    <p class="text-sm font-semibold uppercase tracking-[0.24em] text-[var(--muted)]">Opinie</p>
    <h2 class="text-3xl font-semibold tracking-tight sm:text-4xl">Klienci polecaja</h2>
  </div>
  <div class="mt-8 grid gap-6 lg:grid-cols-3">
    {testimonials.map((item) => (
      <figure class="flex flex-col gap-6 rounded-3xl border border-[var(--border)] bg-[var(--surface)] p-6 shadow-[0_18px_40px_-30px_rgba(0,0,0,0.6)]">
        <blockquote class="text-base text-[var(--text)]">"{item.quote}"</blockquote>
        <figcaption class="text-sm font-semibold text-[var(--text)]">
          {item.name}
          {item.role ? (
            <>
              {' - '}
              <span class="font-normal text-[var(--muted)]">{item.role}</span>
            </>
          ) : null}
        </figcaption>
      </figure>
    ))}
  </div>
</section>
